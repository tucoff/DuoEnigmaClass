<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Enigmas Cooperativos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Fundo Verde Pastel Bem Clarinho
                        'pastel-green': {
                            100: '#EDF7ED', // Fundo principal
                            200: '#C8E6C9', // Acentos leves
                        },
                        // Violeta para Texto (Escuro para leitura, claro para acentos)
                        'pastel-violet': {
                            light: '#D1C4E9', // Bordas, detalhes
                            DEFAULT: '#9575CD',
                            dark: '#4A3B6B', // Texto Principal (Escuro para contraste)
                        },
                        // Vermelho Pastel para Botões
                        'pastel-red': {
                            DEFAULT: '#FFAB91', // Cor normal do botão
                            hover: '#FF8A65',   // Cor ao passar o mouse
                        }
                    },
                    fontFamily: {
                        'sans': ['Poppins', 'ui-sans-serif', 'system-ui'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Animação suave para o loading text */
        .pulse-text { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    </style>
</head>
<body class="bg-pastel-green-100 text-pastel-violet-dark font-sans min-h-screen font-medium">

    <div class="container mx-auto p-4 sm:p-6 max-w-3xl">
        
        <header class="text-center mb-8 sm:mb-12 mt-4">
            <h1 class="text-3xl sm:text-4xl font-bold text-pastel-violet-dark mb-3 tracking-tight">
                Enigmas Cooperativos
            </h1>
            <p class="text-lg text-pastel-violet-dark opacity-80 max-w-xl mx-auto">
                Transforme páginas de livros em desafios divertidos para sua turma.
            </p>
        </header>
        
        <section class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div class="bg-white p-4 rounded-2xl shadow-sm border border-pastel-violet-light flex flex-col items-center text-center">
                <div class="p-3 bg-pastel-violet-light bg-opacity-20 rounded-full mb-3 text-pastel-violet-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.122 2.122 0 0 0-.863-.694l-2.685-1.11a3.84 3.84 0 0 0-1.418-.308H9.12c-.525 0-1.046.103-1.535.308l-2.685 1.11a2.122 2.122 0 0 0-.863.694l-.822 1.316Z" />
                      </svg>                      
                </div>
                <h3 class="font-bold mb-1">1. Tire Fotos</h3>
                <p class="text-sm opacity-75">Fotografe as páginas do livro didático.</p>
            </div>
             <div class="bg-white p-4 rounded-2xl shadow-sm border border-pastel-violet-light flex flex-col items-center text-center">
                <div class="p-3 bg-pastel-violet-light bg-opacity-20 rounded-full mb-3 text-pastel-violet-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09Z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M18.225 19.763 17.438 22l-.787-2.237a2.25 2.25 0 0 0-1.538-1.538L12.9 17.438l2.213-.787a2.25 2.25 0 0 0 1.538-1.538L17.438 12.9l.787 2.213a2.25 2.25 0 0 0 1.538 1.538L22 17.438l-2.237.787a2.25 2.25 0 0 0-1.538 1.538Z" />
                      </svg>                      
                </div>
                <h3 class="font-bold mb-1">2. Gere Enigmas</h3>
                <p class="text-sm opacity-75">Nossa IA cria desafios baseados no conteúdo.</p>
            </div>
             <div class="bg-white p-4 rounded-2xl shadow-sm border border-pastel-violet-light flex flex-col items-center text-center">
                 <div class="p-3 bg-pastel-violet-light bg-opacity-20 rounded-full mb-3 text-pastel-violet-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                      </svg>                      
                </div>
                <h3 class="font-bold mb-1">3. Baixe o PDF</h3>
                <p class="text-sm opacity-75">Imprima e distribua para os grupos.</p>
            </div>
        </section>

        <main class="bg-white p-6 sm:p-8 rounded-3xl shadow-lg border-2 border-pastel-violet-light/30">
            
            <div class="mb-8">
                <label for="imageInput" class="cursor-pointer flex flex-col items-center justify-center w-full h-32 border-3 border-dashed border-pastel-violet-light rounded-2xl bg-pastel-green-100/50 hover:bg-pastel-violet-light/10 transition-colors duration-300 group">
                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-10 h-10 mb-3 text-pastel-violet group-hover:text-pastel-violet-dark transition-colors">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5" />
                          </svg>
                        <p class="mb-1 text-sm text-pastel-violet-dark"><span class="font-bold">Clique para enviar</span> ou arraste aqui</p>
                        <p class="text-xs text-pastel-violet-dark opacity-70">JPG, PNG (Sem limites - processamento em lotes)</p>
                    </div>
                    <input type="file" id="imageInput" accept="image/*" multiple class="hidden" />
                </label>
            </div>

            <div id="imagePreviewGrid" class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6 empty:hidden"></div>

            <div class="mb-6">
                <label for="difficultySelect" class="block text-pastel-violet-dark font-bold mb-2 pl-1">
                    Escolha o Nível do Desafio:
                </label>
                <div class="relative">
                    <select id="difficultySelect" class="block appearance-none w-full bg-white border-2 border-pastel-violet-light text-pastel-violet-dark py-3 px-4 pr-8 rounded-xl leading-tight focus:outline-none focus:bg-white focus:border-pastel-violet focus:ring-2 focus:ring-pastel-violet-light/50 transition-all cursor-pointer">
                        <option value="1">Nível 1 - Muito Fácil (Identificação)</option>
                        <option value="2">Nível 2 - Fácil (Compreensão)</option>
                        <option value="3" selected>Nível 3 - Médio (Aplicação)</option>
                        <option value="4">Nível 4 - Difícil (Análise)</option>
                        <option value="5">Nível 5 - Expert (Síntese)</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-pastel-violet">
                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                    </div>
                </div>
                <p class="text-xs text-pastel-violet-dark opacity-60 mt-1 pl-1">Isso ajusta a complexidade das perguntas geradas pela IA.</p>
            </div>

            <button id="generateBtn" class="w-full bg-pastel-red hover:bg-pastel-red-hover text-white font-bold py-4 px-6 rounded-2xl transition duration-300 ease-in-out transform hover:-translate-y-1 shadow-md text-lg flex justify-center items-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 mr-2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09Z" />
                  </svg>
                Gerar Enigmas Mágicos
            </button>

            <div id="loadingIndicator" class="hidden mt-8 text-center">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-pastel-violet-light border-t-pastel-violet-dark mb-4"></div>
                <p id="loadingText" class="text-pastel-violet-dark font-medium pulse-text">Iniciando a magia...</p>
            </div>

            <div id="resultsArea" class="hidden mt-10 border-t-2 border-pastel-violet-light/30 pt-8">
                <h2 class="text-2xl font-bold text-pastel-violet-dark mb-6 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-2 text-pastel-red" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Enigmas Gerados!
                </h2>
                
                <div id="enigmasList" class="space-y-6"></div>

                <button id="downloadPdfBtn" class="w-full mt-8 bg-pastel-violet-dark hover:bg-opacity-90 text-white font-bold py-4 px-6 rounded-2xl transition duration-300 shadow-md text-lg flex justify-center items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 mr-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
                      </svg>
                    Baixar PDF para Impressão
                </button>
            </div>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        const { jsPDF } = window.jspdf;

        const imageInput = document.getElementById('imageInput');
        const imagePreviewGrid = document.getElementById('imagePreviewGrid');
        const generateBtn = document.getElementById('generateBtn');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const loadingText = document.getElementById('loadingText'); // Novo elemento de texto de loading
        const resultsArea = document.getElementById('resultsArea');
        const enigmasList = document.getElementById('enigmasList');
        const downloadPdfBtn = document.getElementById('downloadPdfBtn');

        let selectedImages = [];
        let generatedEnigmasData = [];

        // --- Funções de UI ---

        // Função para atualizar o texto de loading dinamicamente
        function updateLoadingStatus(status) {
            const statusMessages = {
                'start': 'Iniciando a magia...',
                'upload': 'Lendo as páginas do livro...',
                'processing': 'A IA está criando os desafios...',
                'finishing': 'Quase pronto, finalizando os detalhes...',
                'error': 'Ops, a magia falhou. Tente novamente.'
            };
            if(loadingText) loadingText.textContent = statusMessages[status] || statusMessages['processing'];
        }


        imageInput.addEventListener('change', handleImageSelection);

        function handleImageSelection(event) {
            const files = Array.from(event.target.files);
            
            // Sem limite artificial. O Batching cuidará do resto!
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    selectedImages.push(file);
                    addToPreview(file);
                }
            });
            imageInput.value = '';
        }

        function addToPreview(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const div = document.createElement('div');
                // Estilo do card de preview melhorado com borda pastel
                div.className = 'relative rounded-xl overflow-hidden shadow-sm border-2 border-pastel-violet-light/50 aspect-square group';
                div.innerHTML = `
                    <img src="${e.target.result}" alt="Preview" class="w-full h-full object-cover">
                    <button onclick="removeImage(this, '${file.name}')" class="absolute top-1 right-1 bg-pastel-red text-white rounded-full p-1.5 shadow-sm opacity-80 group-hover:opacity-100 transition-opacity">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                `;
                imagePreviewGrid.appendChild(div);
            };
            reader.readAsDataURL(file);
        }

        function removeImage(button, fileName) {
            button.parentElement.remove();
            selectedImages = selectedImages.filter(img => img.name !== fileName);
        }

        // --- Lógica Principal ---

        generateBtn.addEventListener('click', async () => {
            if (selectedImages.length === 0) {
                alert("Por favor, selecione pelo menos uma imagem.");
                return;
            }

            // UI Updates: Mostra loading, esconde resultados anteriores e botão gerar
            loadingIndicator.classList.remove('hidden');
            resultsArea.classList.add('hidden');
            generateBtn.classList.add('hidden');
            enigmasList.innerHTML = '';
            generatedEnigmasData = [];
            
            // Inicia feedback de loading
            updateLoadingStatus('start');


            try {
                // 1. Upload das Imagens
                updateLoadingStatus('upload');
                const formData = new FormData();
                selectedImages.forEach(file => formData.append('images', file));

                const uploadResponse = await fetch('/upload', { method: 'POST', body: formData });
                if (!uploadResponse.ok) throw new Error('Falha no upload das imagens.');
                const { filePaths } = await uploadResponse.json();

                // 2. Geração dos Enigmas (Backend + IA)
                updateLoadingStatus('processing');
                // Dividir em lotes se houver muitas imagens (exemplo: 2 por lote)
                const batchSize = 2;
                for (let i = 0; i < filePaths.length; i += batchSize) {
                    const batchPaths = filePaths.slice(i, i + batchSize);
                    const enigmas = await generateEnigmasForBatch(batchPaths);
                    generatedEnigmasData = generatedEnigmasData.concat(enigmas);
                }

                // 3. Exibição dos Resultados
                updateLoadingStatus('finishing');
                if (generatedEnigmasData.length > 0) {
                    displayEnigmas(generatedEnigmasData);
                    resultsArea.classList.remove('hidden');
                } else {
                    alert("Não foi possível gerar enigmas a partir das imagens fornecidas.");
                }

            } catch (error) {
                console.error("Erro no processo:", error);
                updateLoadingStatus('error');
                alert("Ocorreu um erro ao processar. Verifique o console ou tente novamente.");
            } finally {
                loadingIndicator.classList.add('hidden');
                generateBtn.classList.remove('hidden'); // Traz o botão de volta
            }
        });

        async function generateEnigmasForBatch(filePaths) {
            // 1. Capturar o nível selecionado pelo usuário
            const selectedLevel = parseInt(document.getElementById('difficultySelect').value);
            
            // 2. Filtrar exemplos do JSON baseados no nível (pegamos exemplos do nível exato e talvez do nível anterior para contexto)
            // Se for nível 1, pega só do 1. Se for 3, pega do 3.
            const relevantExamples = examplesDatabase.filter(ex => ex.difficulty === selectedLevel);
            
            // 3. Montar a string de exemplos para o prompt
            // 3. Montar a string de exemplos para o prompt
            let examplesText = "";
            relevantExamples.forEach((ex, i) => {
                examplesText += `
                EXEMPLO #${i+1}:
                Texto de Referência (O que a IA leu): "${ex.paragrafo_original}"
                Enigma Gerado (Como a IA transformou): "${ex.enigma}"
                Resposta Esperada: "${ex.resposta}"
                -----------------------------------`;
            });

            // 4. Construir o Prompt Dinâmico
            const prompt = `Analise as imagens fornecidas (conteúdo de livro didático).
            
            SEU OBJETIVO: Criar 2 novos enigmas cooperativos baseados EXCLUSIVAMENTE no texto/imagens fornecidos, mas seguindo o NÍVEL DE DIFICULDADE ${selectedLevel}.
            
            Use estes exemplos abaixo como guia de tom, complexidade e estilo de escrita (metáforas, narrativa):
            ${examplesText}
            
            REGRAS OBRIGATÓRIAS:
            1. A saída DEVE ser estritamente um JSON Array válido.
            2. Formato: [{"titulo": "...", "pergunta": "...", "resposta_esperada": "..."}]
            3. Para Nível ${selectedLevel}, use vocabulário e profundidade cognitiva similar aos exemplos acima.
            4. Crie títulos criativos para os enigmas.`;

            // Chamada para o Backend
            const response = await fetch('/generate-enigmas', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ filePaths, prompt })
            });

            if (!response.ok) throw new Error('Falha na geração de enigmas pela IA.');
            const data = await response.json();
            
            try {
                let cleanText = data.enigmasText.replace(/```json/g, '').replace(/```/g, '').trim();
                const enigmasArray = JSON.parse(cleanText);
                if(!Array.isArray(enigmasArray)) throw new Error("Não é array");
                return enigmasArray.map(enigma => ({...enigma, sourceImages: filePaths}));
            } catch (e) {
                    console.error("Erro Parse:", e);
                    return [{
                    titulo: "Erro de Comunicação Mágica",
                    pergunta: "A IA tentou criar um enigma muito complexo e se confundiu. Tente novamente.",
                    resposta_esperada: "N/A",
                    isError: true
                }];
            }
        }

        function displayEnigmas(enigmas) {
            enigmasList.innerHTML = '';
            enigmas.forEach((enigma, index) => {
                // Se for um card de erro de parse
                if(enigma.isError) {
                     const errorDiv = document.createElement('div');
                     errorDiv.className = 'bg-red-50 border-l-4 border-pastel-red p-4 rounded-r-xl shadow-sm';
                     errorDiv.innerHTML = `<p class="text-pastel-red-hover font-bold">${enigma.titulo}</p><p class="text-sm">${enigma.pergunta}</p>`;
                     enigmasList.appendChild(errorDiv);
                     return;
                }

                // Cria o card do enigma (Visual Melhorado com estilo de "Card de Jogo")
                const enigmaCard = document.createElement('article');
                enigmaCard.className = 'bg-white rounded-2xl shadow-md overflow-hidden border-2 border-pastel-violet-light/50 hover:shadow-lg transition-shadow duration-300';
                
                enigmaCard.innerHTML = `
                    <div class="bg-pastel-violet-light/20 p-4 border-b border-pastel-violet-light/30 flex items-center">
                         <div class="bg-white p-2 rounded-full mr-3 shadow-sm">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-pastel-violet-dark" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11.536 16l-1.414 1.414a2 2 0 01-2.828 0L5.414 11.586a2 2 0 010-2.828l1.414-1.414a2 2 0 012.828 0L11.536 9H13a2 2 0 012-2z" />
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold text-pastel-violet-dark">Enigma #${index + 1}: ${enigma.titulo}</h3>
                    </div>

                    <div class="p-5">
                        <div class="mb-4">
                            <h4 class="text-sm font-bold text-pastel-violet uppercase tracking-wider mb-2 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                O Desafio:
                            </h4>
                            <p class="text-pastel-violet-dark text-lg leading-relaxed bg-pastel-green-100/50 p-4 rounded-xl border border-pastel-green-200">
                                "${enigma.pergunta}"
                            </p>
                        </div>

                         <div>
                             <h4 class="text-sm font-bold text-pastel-green-200 uppercase tracking-wider mb-1 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                Resposta Esperada (Gabarito):
                            </h4>
                            <p class="text-pastel-violet-dark font-semibold pl-5">${enigma.resposta_esperada}</p>
                        </div>
                    </div>
                `;
                enigmasList.appendChild(enigmaCard);
            });
        }

        // --- Geração do PDF (Mantida a lógica, ajustado o estilo básico) ---

        downloadPdfBtn.addEventListener('click', () => {
            if (generatedEnigmasData.length === 0) return;

            const doc = new jsPDF();
            let yPos = 20;

            // Título do PDF com cor violeta escura
            doc.setTextColor(74, 59, 107); // #4A3B6B
            doc.setFontSize(22);
            doc.setFont("helvetica", "bold");
            doc.text("Enigmas Cooperativos", 105, yPos, null, null, "center");
            yPos += 15;
            
            doc.setFontSize(12);
            doc.setFont("helvetica", "normal");
            doc.text("Atividade para realizar em grupo. Boa sorte!", 105, yPos, null, null, "center");
            yPos += 25;

            doc.setTextColor(60, 60, 60); // Texto padrão mais escuro

            generatedEnigmasData.forEach((enigma, index) => {
                 if(enigma.isError) return; // Pula erros no PDF

                if (yPos > 250) { doc.addPage(); yPos = 20; }
                
                // Caixa para cada enigma
                doc.setDrawColor(209, 196, 233); // Cor da borda (pastel violet light)
                doc.setFillColor(245, 245, 255); // Fundo bem clarinho
                doc.roundedRect(15, yPos - 5, 180, 45, 3, 3, 'FD'); // Caixa com fundo e borda
                
                // Título do Enigma
                doc.setFontSize(14);
                doc.setFont("helvetica", "bold");
                doc.setTextColor(74, 59, 107); // Título em violeta
                doc.text(`Enigma ${index + 1}: ${enigma.titulo}`, 20, yPos + 5);
                yPos += 15;

                // Pergunta
                doc.setFontSize(12);
                doc.setFont("helvetica", "normal");
                doc.setTextColor(60, 60, 60);
                 // splitTextToSize para quebrar linhas automaticamente
                const splitTitle = doc.splitTextToSize(enigma.pergunta, 170);
                doc.text(splitTitle, 20, yPos);
                // Calcula a altura do texto para ajustar o próximo
                yPos += (splitTitle.length * 7) + 15; 
                
                // Separador
                doc.setDrawColor(230, 230, 230);
                doc.line(20, yPos-5, 190, yPos-5);
                 yPos += 5;

                // Espaço para resposta dos alunos (Opcional: não incluir a resposta no PDF dos alunos)
                // doc.setFont("helvetica", "bold");
                // doc.text("Resposta: __________________________", 20, yPos);
                // yPos += 20;
                 yPos += 10; // Espaço extra entre cards no PDF
            });

            doc.save("Enigmas_Cooperativos.pdf");
        });

    </script>
</body>
</html>